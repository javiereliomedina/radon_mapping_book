# Read data 

## Administrative divisions (

I got Lithuania from www.gadm.org, but you may download the administrative areas of other countries  

```{r adm-units}

  Country <- readRDS(url("https://biogeo.ucdavis.edu/data/gadm3.6/Rsf/gadm36_LTU_0_sf.rds"))
  County  <- readRDS(url("https://biogeo.ucdavis.edu/data/gadm3.6/Rsf/gadm36_LTU_1_sf.rds"))
  Muni    <- readRDS(url("https://biogeo.ucdavis.edu/data/gadm3.6/Rsf/gadm36_LTU_2_sf.rds"))
  
```

## Grids 10 x 10 km 
  
Download from https://www.eea.europa.eu/data-and-maps/data/eea-reference-grids-2
  
```{r grids-EEA, cache=TRUE}
EEA_Ref_grid_URL <- "https://www.eea.europa.eu/data-and-maps/data/eea-reference-grids-2/gis-files/lithuania-shapefile/at_download/file.zip"
  temp  <- tempfile()
  temp2 <- tempfile()
  download.file(EEA_Ref_grid_URL, temp)
  unzip(zipfile = temp, exdir = temp2)
  Grids_10km <- read_sf(file.path(temp2, "lt_10km.shp"))
  unlink(c(temp, temp2))
  
  Grids_10km$Id <- seq(1, length(Grids_10km$CELLCODE), 1)   # Add new column with "Id"
  Grids_10km$Id <- as.factor(Grids_10km$Id)                 # Stored as a vector of integer values
  st_crs(Grids_10km)                                        # Coordinate Reference System
  st_crs(Country)                                           # Coordinate Reference System
  Grids_10km <- Grids_10km %>% st_transform(4326)           # Trandform coordinate system (from  EPSG: 3035 to EPSG: 4326)
  st_crs(Grids_10km)                                        # Coordinate Reference System 
  st_crs(Country)                                           # Coordinate Reference System 
  Grids_10km <- st_intersection(Grids_10km, Country)        # Grids in the country
```


```{r plot-grids}

plot(Grids_10km["Id"])
   
```
    
## Make our own grid (e.g. 0.1 x 0.1 degrees)

```{r make-grids}

# Make regular grids (0.1 x 0.1)
  Grids <- Country %>% 
    st_make_grid(cellsize = 0.1, what = "polygons") %>%
    st_sf() %>%
    st_intersection(Country) %>%
    # Name grids as "g001", "g002"
    mutate(ID = paste0("g", stringr::str_pad(seq(1, nrow(.), 1), 3, pad = "0")))

# Centroid of the grid
  SPDF  <- st_centroid(Grids) 

```

```{r}
  
  plot(Country["NAME_0"], reset = F, main = "Lithuania: cells 0.1x0.1 degrees")
  plot(Grids, add = T, border = 2)
  plot(SPDF, add = T, col = "blue")
   
```

## Geology 1:5M 

Download from [BGR](https://produktcenter.bgr.de/terraCatalog/DetailResult.do?fileIdentifier=9FD6624C-0AA7-46D4-9DA3-955E558CD5F1) [@Asch2003] 
```{r BG, cache=TRUE}

  IGME5000_url <- "https://download.bgr.de/bgr/Geologie/IGME5000/shp/IGME5000.zip" 
  temp <- tempfile()
  temp2 <- tempfile()
  download.file(IGME5000_url, temp)
  unzip(zipfile = temp, exdir = temp2)
  IGME5000 <- read_sf(file.path(temp2, "europe/data/IGME5000_europeEPSG3034shp_geology_poly_v01.shp"))
  unlink(c(temp, temp2))
    
  st_crs(IGME5000)
  st_crs(Country)
  
  IGME5000 <- IGME5000 %>%
    st_transform(4326) %>%
    st_intersection(Country)
  st_crs(IGME5000)
  plot(IGME5000["AgeName"])
```

## Study area 

I will focus the data analysis in a region of of 1x1 degrees

```{r study-area}

#  First: build a rectangle 
  Area <- matrix(NA, ncol = 2, nrow = 4)
  Area <- as.data.frame(Area)
  names(Area) <- c("X","Y")
  Area[1,] <- c(23,55)
  Area[2,] <- c(23,56)
  Area[3,] <- c(24,56)
  Area[4,] <- c(24,55)
  
  coordinates(Area) <- ~X+Y
  Area <- rbind(Area,Area[1,])
  Area <- Polygons(list(Polygon(Area)),ID="Area")
  Area <- SpatialPolygons(list(Area))
  Area <- as(Area, "sf")
  st_crs(Area) <- st_crs(Country)
  
  plot(Country["NAME_0"], axes = TRUE, reset = F)
  plot(Area, col = "blue", add = T)
  
# Second: intersect Area with all the data
  Country <- st_intersection(Country, Area)
  County <- st_intersection(County, Area)
  Muni <- st_intersection(Muni, Area)
  Grids_10km <- st_intersection(Grids_10km, Area)
  IGME5000 <- st_intersection(IGME5000, Area)

```

## Indoor radon (simulated data) 

Please be aware that I am using SIMULATED data, and therefore data interpretation is NOT real. Any coincidence with a real case (i.e. Lithuania) is casual. Data are only useful for training purpose, you may need to read your own data for data interpretation.  
  
```{r sim-InRn, cache=TRUE}

  set.seed(1)  # Make the simulation reproducible
  
# Radom points in the study area 
  N <- 1000
  X <- runif(N,23.0001,23.9999)
  Y <- runif(N,55.0001,55.9999)
  points <- cbind(X,Y)
  points <- as.data.frame(points)
  coordinates(points) <- ~X+Y
  proj4string(points) <- CRS("EPSG:4326")
  points <- as(points, "sf")
  points <- st_intersection(points, Country)
  points <- as_Spatial(points)                

# define the gstat object (spatial model)
  library(gstat)
  g_dummy <- gstat(formula = z ~ 1,
                   locations = ~ X + Y,
                   dummy = T,
                   beta = 3,
                   model = vgm(psill = 1.5, 
                               model = "Exp",
                               range = 10,
                               nugget = 0.5),
                   nmax  = 100)
  
# Simulations based on the gstat object
  points <- predict(g_dummy, newdata = points, nsim = 1)
  points$Rn    <- exp(points$sim1)
  
# Final result: Simulated indoor radon dataset (InRn) in Bq m-3
  InRn <- points[,"Rn"]
  
# Detection Limit (DL): 10 Bq m-3 (replaced by half of the Limit of Detection)
  InRn[InRn$Rn <= 10,] <- 5
  InRn <- as(InRn, "sf") %>% 
    st_transform(crs = "EPSG:4326")
  
```
 